## Backup
   + сжать большие файлы
   + сохранить файлы где хочешь
   + на школьном маке: создать папку с таким же названием и по тому же пути в goinfre, скачать туда файлы, распаковать, запустить virtualbox (не менять конфигурацию в virtualbox)
   + на другом компе: скачать и разархивировать конфигурацию, virtualbox - Инструменты - зелёный плюсик "Добавить", указав папку с файлом Debian.vbox и прочими файлами

## Выход в интернет или локальную сеть  
* инструменты:
  + NAT
  + сетевой мост
  + внутренняя сеть
  + виртуальный адаптер хоста
  + универсальный драйвер
  + сеть NAT
  + Cloud Network
* для одной гостевой ОС можно использовать до 4 сетевых адаптеров, но обычно достаточно 1

### По умолчанию
* NAT = Network Address Translation (**NAT**) = совместный доступ
* Виртуальный сетевой адаптер "VirtualBox Host-Only Enthernet Adapter"
* VM и основная ОС совместно используют одно подключение к физической сети TCP/IP
* сетевые интерфейсы VM и хостовой машины изолированы
  + у VM виртуальная сеть, в которой она одна
  + VM не указывается в сети в качестве отдельного компьютера
  + нет возможности получить доступ к сервисам VM (веб-серверу, ssh, ...) из хостовой 
  + VM недоступна для внешней сети (internet)
* с VM можно просматривать интернет-сайты и выполнять различные действия в сети
  + VM получает сетевой адрес и другие настройки в локальной сети от сервера DHCP встроенного в VirtualBox
    - IP адрес VM != сетевой адрес сети хоста
    - первая сетевая карта NAT принадлежит локальной сети 10.0.2.0
  + VM подключается к сети через маршрутизатор (сетевой модуль VirtualBox), также как реальный компьютер подключается к Internet 
    - Маршрутизатором обрабатывает сетевой трафик VM
    - модуль VirtualBox NAT получает cетевые пакеты посылаемые гостевой ОС 
    - VirtualBox NAT пересылает данные стека TCP/IP хосту
    - VirtualBox NAT определяет, какие данные посылать приложениям хоста, а какие другим компьютерам той же сети, что и хост, используя сетевой интерфейс хоста
    - VirtualBox перехватывает и пересылает ответные пакеты VM

### Подключить VirtualBox к интернету
* Virtualbox
  + по умолчанию подключение к интернету с помощью NAT => нет возможности подключаться к виртуальной машине из своей ОС => вы не сможете подключиться по SSH
  + проброс портов через NAT => можете
* При создании каждая виртуальная машина автоматически получает доступ в интернет при помощи NAT
  + самый простой способ подключения к интернету
  + не требует дополнительных настроек
  + нет доступа к другим гостевым ОС
  + NAT изолирует виртуальную машину от соединений извне
  + проводником в интернет выступает хост-система, через неё проходят все входящие и исходящие запросы
  + если вам нужен только доступ в интернет, используйте NAT-подключение

### Сеть между хостом и VirtualBox
* тип подключения Сетевой мост
  + виртуальная машина подключается напрямую к основной сети как полноценное устройство
  + для подключения используется сетевая карта хост-системы
* set your networking to Bridged
  + you should be able to access your host machine by its hostname
  + if your hostname is “inception” and you want to open http://localhost:3000/, you will be able to view that page at http://inception:3000/
 + to find your hostname, open a terminal/console and then run the command hostname

### Сеть между виртуальными машинами в VirtualBox
...

### Доступ к какому-либо сервису хостовой машины
* 1 способ: пробросить пробросить порт сервиса в хостовую систему через Port Forwardign Rules, port forwarding Virtualbox via NAT
  + у вас должен быть внешний белый ip
  + опция NAT
  + Имя
  + Протокол - протокол, по которому работает сервис, например, tcp
  + Адрес хоста - адрес на хостовой машине, подключения к которому будут направляться на виртуальную машину
    - можно написать ip в локальной сети
    - нельзя указывать 127.0.0.1, на этом адресе вы сможете получать и передавать пакеты только на него же, даже на виртуалку не сможете, потому что на виртуалке свой 127.0.0.1
    - `ifconfig` узнать адрес хоста в локальной сети
  + Порт хоста - подключения к которому нужно перенаправлять на VM
  + Адрес VM - куда направлять подключения, оставьте пустым
    - а то весь интернет сможет подключиться к вашему виртуальному серверу 
  + Порт гостя - на который будут перенаправлены подключения с этого порта
    - порт с которого вы перенаправляете и на который перенаправляете не должны совпадать
    - если перенаправлять с порта 80 на 80, то работать не будет
    - с 8080 на 80 ок
    - можно сделать командой `VBoxManage modifyvm "Имя машины" --natpf1 "rulename,tcp,127.0.0.1,8080,,80"` (вместо Port Forwardign Rules)
   + NAT преобразовывает скрытые локальные IP-адреса сети во внешние
   1) открыть порты на гостевой машине:
   + `service ssh start`
   + `ufw status`
   2) перенаправить траффик с хостовой на гостевую: 
   + на виртуальной машине `ip addr` или `ifconfig` -> узнать IP адрес, который присваивается виртуальной машине
* 2 способ
  + нет внешнего белого ip
  + запустить сеть виртуальной машины в режиме "Сетевой мост" вместо NAT
  + виртаулку автоматически видно всем из сети
  + на виртуалке нет интернета
  + в Port Forwardign Rules айпи = 0.0.0.0
* 3 способ: сетевой мост
  + для подключения виртуальной машины к физической сети TCP/IP в качестве отдельного компьютера используется физический сетевой адаптер
  + VM функционирует как отдельный физический компьютер в сети
  + настроить на NAT ?
  + VirtualBox использует драйвер устройства на хост системе
  + требуется драйвер от VirtualBox на хост системе
  + драйвер обрабатывает данные проходящие через физический сетевой интерфейс
  + драйвер обычно называют "net filter
  + драйвер перехватывает VirtualBox пакеты из физической сети и изменяет данные в них
  + драйвер создаёт новые программные сетевые интерфейсы
    - когда гость использует такой программный интерфейс, то как будто гостевая система подключается к физической сети
    - хост система может посылать и принимать данные от гостевой
    - физический интерфейс хоста = маршрутизатор или шлюз между гостевой системой и вашей физической сетью
* 4 способ: "Виртуальный адаптер хоста"
  + если к виртуалке нужен доступ только с хоста, по умолчанию виртуалке присваивается адрес из сети 192.168.56.0/24, на хосте при этом 192.168.56.1
  + сможете обращаться к ВМ по ее IP адресу
  + выдать виртуальной машине отдельный IP адрес
  + можно обращаться к любым ее портам и использовать любые сетевые возможности

`wget http://localhost/index.html` проверить без браузера

## Error
```
"Could not open the medium '/mnt/nfs/homes/akostrik/sgoinfre/Inception/Inception.vdi'.
VDI: error reading pre-header in '/mnt/nfs/homes/akostrik/sgoinfre/Inception/Inception.vdi' (VERR_IS_A_DIRECTORY).
VD: error VERR_VD_VDI_INVALID_HEADER opening image file '/mnt/nfs/homes/akostrik/sgoinfre/Inception/Inception.vdi' (VERR_VD_VDI_INVALID_HEADER).
Result Code: 
NS_ERROR_FAILURE (0x80004005)
Component: 
MediumWrap
Interface: 
IMedium {ad47ad09-787b-44ab-b343-a082a3f2dfb1}" 
```
* Install HxD Hex Editor to open .vdi file as streams of bytes (http://download.cnet.com/HxD-Hex-Editor ... tag=button)
* pre-header = the first 72 bytes (http://forums.virtualbox.org/viewtopic.php?t=52)
* create a new vm `test.vdi` with all default options
* Open `test.vdi` and copy its first 72 bytes
* overwrite them in the invalid vdi file that you want to fix
* reboot your vm using the modified vdi
