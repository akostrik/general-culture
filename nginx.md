* def: **веб-сервер** (**HTTP-сервер**) обрабатывает запросы от клиентов по протоколам HTTP и HTTPS, возвращает ответ в виде HTML-страницы
  + обслуживание неизменяемых запросов, индексных файлов, автоматическое создание списка файлов, кэш дескрипторов открытых файлов
  + акселерированное проксирование без кэширования, простое распределение нагрузки и отказоустойчивость
  + поддержка кеширования при акселерированном проксировании и FastCGI
  + акселерированная поддержка FastCGI и memcached-серверов, простое распределение нагрузки и отказоустойчивость
  + модульность, фильтры, в том числе сжатие (gzip), byte-ranges (докачка), chunked-ответы, HTTP-аутентификация, SSI-фильтр
  + несколько подзапросов на одной странице, обрабатываемых в SSI-фильтре через прокси или FastCGI, выполняются параллельно
  + поддержка SSL, PSGI, WSGI, экспериментально встроенного Perl
  + конфигурация разделяется на виртуальные серверы
    - для виртуального сервера возможно задать адреса, порты, имена
    - виртуальные серверы разделяются на locations
       = locations могут задаваться точным URI, частью URI, регулярным выражением
       = Locations могут быть сконфигурированы для обслуживания запросов из статического файла, проксирования на fastcgi/memcached сервер
* def: **прокси-сервер** принимает и обрабатывает запросы клиентов, передает их другим программам
* def: **обратный прокси-сервер** принимает результат работы других серверов, отдаёт его клиентам
* def: **SMTP/IMAP/POP3-прокси сервер** (**почтовый прокси-сервер**)
  + перенаправление пользователя на SMTP/IMAP/POP3-бэкенд с использованием внешнего HTTP-сервера аутентификации
  + простая аутентификация (LOGIN, USER/PASS)
  + поддержка SSL, STARTTLS
* def: **балансировщик нагрузки** распределяет сетевые запросы между серверами, следуя настройкам балансировки
* usage
  + решить проблему с проседанием под нагрузкой
  + для обработки запросов с сайтов, где много статического контента
  + обслуживания серверов, на которые поступает много запросов одновременно
  + для распределения нагрузки на серверную часть
  + SSL/TLS терминация, обеспечивая шифрование / дешифрование данных между клиентами и серверами => снижает нагрузку на бэкэнд-серверы и улучшает безопасность
  + goal: Кеширование и стриминг видео
  + goal: Построение CDN-сетей
  + goal: Распределение нагрузки
  + goal: Обеспечение безопасности
  + goal: хостинг нескольких сайтов на одном сервере
* простой, быстрый, надёжный, не перегруженный функциями
* 10,000 одновременных запросов, при этом расходовать минимум памяти, не теряя производительности
* защита от DDOS
* как работает
  + пользователь совершает действие на странице
  + информация передается на сервер
  + сервер находит файлы, передает сведения
  + если обрабатывать запросы каждого пользователя по отдельности, серверу придется одновременно выполнять много процессов, сайт начнет работать медленно
  + Nginx обходит это: его архитектура асинхронная, запросы обрабатываются на разных этапах => скорость обработки
  + Запросы от одного пользователя разбиваются на маленькие структуры — сетевые соединения, за однотипные действия отвечает один процесс
  + После обработки соединения собираются в одном виртуальном контейнере, чтобы преобразоваться в единый первоначальный запрос, а затем отправляются пользователю
  + Благодаря такому принципу работы Nginx одно сетевое соединение может обслуживать до 1024 запросов
  + фиксированное число процессов => максимально эффективно использовать ресурсы сервера
  + рабочие процессы обслуживают одновременно множество соединений, мультиплексируя их вызовами операционной системы select, epoll (Linux) и kqueue (FreeBSD)
  + рабочие процессы выполняют цикл обработки событий от дескрипторов
  + полученные от клиента данные разбираются с помощью конечного автомата
  + разобранный запрос последовательно обрабатывается цепочкой модулей
  + ответ клиенту формируется в буферах, которые хранят данные либо в памяти, либо указывают на отрезок файла, буфера объединяются в цепочки, определяющие последовательность, в которой данные будут переданы клиенту
  + если операционная система поддерживает эффективные операции ввода-вывода (writev, sendfile), то nginx применяет их по возможности
* как понимает, что нужно отдавать клиенту и по какому запросу?
  + анализирует HTTP-запрос клиента, ищет совпадения со значениями условий директив server_name и listen в контексте server
  + когда найдены начинает искать совпадения с условиями обработки location, который отвечает за маршрутизацию запросов
* событийная архитектура позволяет масштабироваться до сотен тысяч параллельных соединений, обрабатывает множество соединений в одном процессе
* Чтобы уменьшить нагрузку на оперативную память: **Пул** —  последовательность предварительно выделенных блоков динамической памяти, динамический и может расширяться при увеличении длины запроса. Если размер объекта превышает значение константы NGX_MAX_ALLOC_FROM_POOL либо длину блока, то он полностью выделяется из кучи. Таким образом, мелкие объекты выделяются очень быстро и имеют накладные расходы только на выравнивание
* содержит модуль географической классификации клиентов по IP-адресу. В его основу входит база данных соответствия IP-адресов географическому региону, представленная в виде radix tree в оперативной памяти. nginx предварительно распределяет первые несколько уровней дерева таким образом, чтобы они занимали ровно 1 страницу памяти. Это гарантирует, что при поиске IP-адреса для первых нескольких узлов при трансляции адреса всегда найдётся запись в TLB
* модульная система, благодаря которой nginx может расширять свои функции
* `etc/nginx/nginx.conf`, корневой конфигурационный файл, глобальные настройки, с nginx.conf начинает парсить конфигурационные файлы, которые состоят из директив
* `/etc/nginx/site-available` или `/etc/nginx/conf.d/`, конфигурация конкретных сайтов, контекст работы с сервером и контекст работы с маршрутизацией запросов
* главный конкурент Apache

  ![Screenshot from 2024-03-08 14-21-25](https://github.com/akostrik/general-culture/assets/22834202/7299967d-0c56-48db-9303-ab4b8d37ab5a)
  ![Screenshot from 2024-03-08 14-58-54](https://github.com/akostrik/general-culture/assets/22834202/21c2e1af-1da8-441b-ae20-47201cf09d5e)
