## Verifications
* netstat = network statistic
  + `netstat -ntlp | grep LISTEN` список прослушиваемых портов (network statistic)
  + `sudo netstat -ltupan` (l прослушивающиеся сокеты, n номера портов вместо названий служб, t TCP-соединения, u UDP-соединения, a только активные соединения)
* ss = современная альтернатива для netstat (socket statistics)
  + `ss -lntu` (l все прослушивающиеся сокеты, n  номера портов вместо названий служб, t TCP-соединения, u UDP-соединения)
* `nmap localhost`
  + проверка открытых портов на удаленных хостах
  + проверка нашей системы
* `sudo nmap -sT -sU -sV 159.89.108.187`
  + sT показать TCP-соединения
  + sU показать UDP-соединения
  + sV обнаружение версий программного обеспечения
* `lsof -i` открытые соединения (list of open files)
* `lsof -nP -i` доступные соединения
* `lsof -i :80` процессы, работающих с портом 80
* `lsof -nP -i | grep LISTEN` список прослушиваемых портов
* `ss -ltupn` почти как netstat
* `ip addr show` network interfaces
* `ip addr` узнать IP
  + `ipconfig` depreciated 
* `telnet loclhost 80` verify

## IP
`ip addr show | grep inet| awk '{print $2; }'` my IP  

## Ports
* порт = логический объект
  + конечная точкой связи в сетевых соединениях
  + связан с процессом или службой
  + находится в одном из четырех состояний: открыт, закрыт, filtered, unfiltered
  + если порт открыт, то программное обеспечение целевого оборудования прослушивает его соединения и пакеты
* открытый порт не представляет опасности
  + может быть угрозой безопасности ОС, если его использует какая-то программа
* 21 ftp
* 22 SSH
* 53 DNS  
* 80 HTTP  
* 443 HTTPS  
* 3306 MySQL  

## Socket
* IP + номер порта

## NAT = Network Address Translation = IP Masquerading = Network Masquerading = Native Address Translation = трансляция сетевых адресов
![Screenshot from 2024-06-07 16-11-34](https://github.com/privet100/general-culture/assets/22834202/27cd8dc7-fee4-4c40-90e5-6dbcc5f8899c)
* механизм в сетях TCP/IP
* une fonctionnalité réseau utilisée sur les routeurs (par exemple, une Box Internet) pour faire communiquer deux réseaux différents (le réseau local et Internet)
* используется для подключения устройств в локальной сети к Интернет
* изменение IP-адреса во время передачи пакетов Ethernet через маршрутизатор
* преобразовывает IP-адреса транзитных пакетов
* преобразовывает скрытые локальные IP-адреса сети во внешние
* преобразование адреса может производиться маршрутизирующим устройством (маршрутизатором, сервером доступа, межсетевым экраном)
* **SNAT** наиболее популярный
  + замена адреса источника при прохождении пакета в одну сторону и обратной замене адреса назначения в ответном пакете
* роутер принимает пакет от локального компьютера
  + если IP-адрес назначения локальный адрес, то пакет пересылается другому локальному компьютеру
  + если нет, то пакет надо переслать наружу в интернет
    - обратным адресом в пакете указан локальный адрес компьютера, который из интернета будет недоступен
    - роутер на лету подменяет обратный IP-адрес пакета на свой внешний (видимый из интернета) IP-адрес и меняет номер порта (чтобы различать ответные пакеты)
    - комбинацию, нужную для обратной подстановки, роутер сохраняет у себя во временной таблице
* сэкономить IP-адреса
  + транслирует несколько внутренних IP-адресов в один внешний публичный IP-адрес
  + так построено большинство сетей в мире: на небольшой район домашней сети местного провайдера или на офис выделяется 1 публичный (внешний) IP-адрес, за которым работают и получают доступ интерфейсы с приватными (внутренними) IP-адресами
* предотвратить или ограничить обращение снаружи ко внутренним хостам, оставляя возможность обращения изнутри наружу
  + при инициации соединения изнутри сети создаётся трансляция
  + ответные пакеты, поступающие снаружи, соответствуют созданной трансляции и поэтому пропускаются
  + если для пакетов, поступающих снаружи, соответствующей трансляции не существует, они не пропускаются
* скрыть внутренние сервисы внутренних хостов/серверов
  + это та же трансляция на определённый порт
  + но возможно подменить внутренний порт официально зарегистрированной службы (например, 80-й порт TCP (HTTP-сервер) на внешний 54055-й)
  + снаружи, на внешнем IP-адресе после трансляции адресов на сайт (или форум) для осведомлённых посетителей можно будет попасть по адресу http://example.org:54055, но на внутреннем сервере, находящемся за NAT, он будет работать на 80-м порту
* source NAT = предоставления пользователям локальной сети с внутренними адресами доступа к сети Интернет
* destination NAT = обращения извне транслируются межсетевым экраном на компьютер пользователя в локальной сети, имеющий внутренний адрес и потому недоступный извне сети без NAT

##  DNS server (Domain Name System)
* распределённая система для получения информации о доменах
* для получения IP-адреса по имени компьютера
  +  для людей проще запоминать буквенные адреса
* для получения информации о маршрутизации почты и/или обслуживающих узлах для протоколов в домене (SRV-запись)
* поддерживается с помощью иерархии DNS-серверов, взаимодействующих по определённому протоколу
* иерархическая структура имён и зон: каждый сервер, отвечающий за имя, может передать ответственность за дальнейшую часть домена другому серверу => ответственность за информацию на серверах различных организаций, отвечающих только за «свою» часть доменного имени
* дополнительные возможности
  + динамические обновления
  + проверка целостности передаваемых данных DNS Security Extensions (**DNSSEC**)
    - данные не шифруются
    - достоверность проверяется криптографическими способами
    - передача криптографической информации (сертификатов), используемых для установления безопасных и защищённых соединений   
  + защита транзакций (TSIG)
  + поддержка различных типов информации
* в браузере `8.8.8.8`
### /etc/hosts
  + информация о домене и IP-адресе, который ему соответствует
  + сменить алиас локального домена (127.0.0.1) на something.42.fr
  + до появления DNS служил маршрутизатором: первоначально преобразование между доменными и IP-адресами производилось с использованием текстового файла hosts, который составлялся централизованно и автоматически рассылался на каждую из машин в своей локальной сети, но с ростом сети возникла необходимость в автоматизированном механизме
  + обладает приоритетом перед DNS-серверами, можно зайти на сайт, не дожидаясь делегирования домена
  + можное заблокировать на локальном компьютере доступ к определённому сайту, указав соответствующую запись
### /etc/resolv.conf
  * config of **DNS resolver**
  * translates human-friendly domain names into the numeric IP addresses
```
                              # when no domain suffix is supplied -> the given query name + search domains = a fully qualified domain 
search example.com local.test # tries additionally somehost.example.com and somehost.local.test
                              # a list of IP addresses of nameservers for resolution:
nameserver 10.0.0.17          # the resolver to query for the name server with IP 10.0.0.17
nameserver 10.1.0.12          # is only used when the first or last used server is unavailable
nameserver 10.16.0.7
```
## DHCP Dynamic Host Configuration Protocol 
* un protocole client/serveur
* fournit IP et d’autres informations (masque de sous-réseau, passerelle par défaut) de configuration à un hôte
* permet aux hôtes d’obtenir les informations de configuration TCP/IP

## CGI = Common Gateway Interface
* спецификация интерфейса
* для связи с веб-сервером
* веб-сервер
  + получает запрос от клиента
  + преобразует в CGI-форму
  + вызывает обработчик
  + конвертирует ответ обработчика из CGI-формы в форму HTTP-ответа клиенту
* скрипты помещают в каталог cgi (или cgi-bin) сервера 
* ранее был одним из наиболее распространённых средств создания динамических сайтов

## FastCGI
* интерфейс
* клиент-серверный протокол взаимодействия веб-сервера и приложения
* развитие технологии CGI
  + более производительный и безопасный по сравнению с CGI
    
## iptables
* гибкий и надежный фаервол 
* интерфейс управления работой межсетевого экрана (брандмауэра) netfilter 
* второе значение: сам межсетевой экран
* защищает от угроз сети и уязвимостей программного обеспечения, установленного на компьютере
  + для домашних компьютеров это не актуально, они подключены к сети через роутеры и NAT, которые скрывают их от внешней сети
  + для серверов актуально 
  + защита системы от внешних вторжений, перенаправление портов, действий с трафиком
* подсистема iptables и Netfilter встроена в ядро
* сетевые пакеты, проходящие через компьютер, отправляются им или предназначены ему, ядро направляет через фильтр iptables
  + проверка + если проверка пройдена, действие
* пакеты: входящие / исходящие / проходящие => в фильтре iptables пакеты делятся на три цепочки:
  + Input - обрабатывает входящие пакеты и подключения (внешний пользователь пытается подключиться по ssh, веб-сайт отправит вам контент по запросу браузера, ...)
  + forward - для проходящих соединений (на маршрутизаторах, если компьютер раздает wifi, ...)
  + output - для исходящих пакетов и соединений (пакеты, созданный при попытке выполнить ping losst.pro, когда вы запускаете браузер и пытаетесь открыть любой сайт, ...)
* содержит пять таблиц:
  + `filter` все действия, типичные для межсетевых экранов
  + `nat` для преобразования сетевых адресов (например, проброс портов)
  + `raw` для настройки пакетов, поэтому они освобождаются от отслеживания // используется в сложных конфигурациях с несколькими маршрутизаторами
  + `mangle` для специальных преобразований пакетов // используется в сложных конфигурациях с несколькими маршрутизаторами
  + `security` в сетевых правилах для Мандатного управления доступом // используется в сложных конфигурациях с несколькими маршрутизаторами
* таблицы состоят из цепочек
* **цепочка** = набор правил, следующих друг за другом в определённом порядке
* таблица filter содержит три встроенные цепочки: INPUT, OUTPUT, FORWARD, активируются в определённые моменты фильтрации пакетов
* таблица nat включает стандартные цепочки PREROUTING, POSTROUTING, OUTPUT
* описание стандартных цепочек других таблиц можно найти в `iptables(8)`
* по умолчанию все цепочки пусты, не содержат каких-либо правил
* вы должны добавить правила в те цепочки, которые собираетесь использовать
* у цепочек также задана политика по умолчанию — обычно ACCEPT
  + её можно изменить на DROP, если вы хотите убедиться, что ни один пакет не проскочит мимо вашего набора правил
  + политика по умолчанию применяется к пакету только после того, как он пройдёт через все существующие правила
* фильтрация пакетов основана на правилах
* **правило** = несколько условий и действия-цели
  + если пакет соответствует всем условиям, то к нему применяется указанное действие
  + например, на какой интерфейс пришёл пакет (eth0, eth1), какого он типа (ICMP, TCP, UDP), на какой порт направляется
* **цель**
  + указывается опцией `-j/--jump`
  + может быть встроеной (built-in): ACCEPT, DROP, QUEUE, RETURN,... - участь пакета решается незамедлительно и обработка пакета в таблице прекращается
  + может быть целью-расширением (extension): REJECT, LOG, ...
    - могут быть завершающими (как встроенные) или незавершающими (как пользовательские цепочки), подробнее см. iptables-extensions(8)
  + может быть переходом на пользовательскую цепочку - пакет проходит через неё, возвращается в исходную цепочку и продолжает со следующего после перехода правила
    - можете добавить собственные цепочки для большей эффективности или удобства, пример создания цепочек можно найти в статье Настройка межсетевого экрана
* вы не можетеотключить iptables остановив сервис обновления правил iptables, подсистема работает на уровне ядра
* `iptables -L` правила брандмауэра iptables
  + понять, какие порты закрыты с его помощью
  + цепочка INPUT отвечает за открытые порты
    - через нее проходят все входящие пакеты
    - политика по умолчанию - ACCEPT = подключение ко всем портам разрешено
  + цепочка OUTPUT
  + цепочка FORWARD
* `iptables -t nat --list`
* `sudo iptables -F` очистить правила, если сделаете что-то не так
* `sudo iptables -I INPUT -p tcp --dport 1924 -j ACCEPT` открыть порты
* https://losst.pro/nastrojka-iptables-dlya-chajnikov
  
```
                               XXXXXXXXXXXXXXXXXX
                             XXX      Сеть      XXX
                                       |
                                       v
+---------------+             +-------------------+
|таблица: filter| <---+       |таблица: nat       |
|цепочка: INPUT |     |       |цепочка: PREROUTING|
+-------+-------+     |       +--------+----------+
        |             |                |
        v             |                v
[локальный процесс]   |         ***************          +----------------+
        |             +-------+  Маршрутизация  +------> |таблица: filter |
        v                       ***************          |цепочка: FORWARD|
 ***************                                         +-------+--------+
  Маршрутизация                                                  |
 ***************                                                 |
        |                                                        |
        v                       ***************                  |
+---------------+     +------>   Маршрутизация   <---------------+
|таблица: nat   |     |         ***************
|цепочка: OUTPUT|     |                +
+------+--------+     |                |
        |             |                v
        v             |      +---------------------+
+---------------+     |      | таблица: nat        |
|таблица: filter| +---+      | цепочка: POSTROUTING|
|цепочка: OUTPUT|            +---------+-----------+
+---------------+                      |
                                       v
                               XXXXXXXXXXXXXXXXXX
                             XXX      Сеть      XXX
                               XXXXXXXXXXXXXXXXXX
```

## telnet = terminal network = telecommunication network =teletype network
* un protocole utilisé sur tout réseau TCP/IP
* permet de communiquer avec un serveur distant en échangeant des lignes de texte et en recevant des réponses également sous forme de texte
* un moyen de communication très généraliste et bi-directionnel
* appartient à la couche application du modèle OSI et du modèle ARPA
* il était utilisé pour administrer des serveurs Unix distant ou de l'équipement réseau, avant de tomber en désuétude par défaut de sécurisation (le texte étant échangé en clair) et l'adoption de SSH

## NIC = Network Interface Controller = сетевой адаптер = сетевая карта = сетевая плата = Ethernet-адаптер
* соединяет компьютер с сетью (локальной, интернетом, интранетом) и обмен данными между устройствами
* функция:
  + получение данных из сетевого кабеля и перевод в формат, который может распознать процессор компьютера
  + отправка данных с ПК к сетевому кабелю
  + кодирование и декодирование данных при передаче по сети
  + передача данных между компьютерами и устройствами внутри сети
* компоненты:
  + контроллер, функция микропроцессора и обрабатывает данные
  + порт, к которому подключается кабель Ethernet
  + разъем ROM для подключения рабочих станций к сети
  + антенна, усиливающая сигнал при беспроводном соединении с сетью
* модели
  + физические внешние
  + физические встроенные
  + виртуальные
    - это не устройство, а интерфейс
    - работает на базе приложения или программного обеспечения в ОС
    - только в виртуальных средах
    - «Выйти в интернет» без физической сетевой карты не получится
    - для взаимодействия между виртуальными машинами и для получения дополнительных сетевых интерфейсов
* исходя из поколения шины:
  + ISA, 1981 г., небольшая скорость передачи
  + PCI, 1990 г., устраели
  + PCI-X, модернизированная вариация PCI, используется для серверов
  + PCIe, новейший стандарт, применяется на ПК и серверах
  + USB, стандарт внешней шины, подходит для подсоединения к Wi-Fi
* по типу портов:
  + оптический с оптоволоконным кабелем
  + AUI с толстым коаксиальным кабелем
  + BNC с тонким коаксиальным кабелем
  + RJ-45 с кабелем витой пар

## *
* **Wireshark** инструмент для захвата и анализа сетевого трафика
